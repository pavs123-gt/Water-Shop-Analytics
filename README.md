# üíß Water Shop Monitoring & Analytics System
### CCTV-Based Customer, Payment & Operational Analytics
The **Water Shop Monitoring & Analytics System** automates customer tracking and operational analytics using computer vision and data analytics.
The system identifies customers using **facial recognition**, tracks visit frequency, links transactions, detects unpaid customers, and analyzes peak business hours.

---

## Table of Contents
- [Project Overview](#project-overview)
- [Objectives](#objectives)
- [Features](#features)
- [Dataset Format](#dataset-format)
- [Project Structure](#project-structure)
- [Setup & Installation](#setup--installation)
- [Processing Pipeline](#processing-pipeline)
- [Analytics & Reports](#analytics--reports)
- [Dashboard & Visualization](#dashboard--visualization)
- [Tools Used](#tools-used)
- [Future Enhancements](#future-enhancements)
- [Author](#author)
 

---

##  Project Overview
The **Water Shop Monitoring & Analytics System** automates customer tracking and operational analytics using computer vision and data analytics.

The system identifies customers using **facial recognition**, tracks visit frequency, links transactions, detects unpaid customers, and analyzes peak business hours.

---

##  Objectives
- Identify customers using CCTV footage and facial recognition  
- Assign unique customer IDs  
- Track visit frequency per customer  
- Analyze payment methods (Cash / UPI / Coins)  
- Track water can usage and sales  
- Detect unpaid and repeat defaulters  
- Identify peak and idle business hours  
- Generate automated reports  

---

## Features
- Face detection and recognition from CCTV videos  
- Customer visit tracking and repeat analysis  
- Transaction and payment mode analytics  
- Can size and quantity tracking (10L, 20L, etc.)  
- Unpaid customer identification  
- Staff optimization using traffic analysis  
- Automated shop opening and closing time detection  
- Dashboard-based visualization  

---

## Dataset Format

### CCTV Footage
The CCTV footage used in this project is a **single continuous video of approximately 2 hours**, captured during normal water shop operating hours and **provided directly by the shop manager**.

üìπ **CCTV Video File:**  
üëâ [Download CCTV Footage](./dataset/cctv_footage.mp4)

- Used for customer detection, face recognition, and visit tracking  
- Captured from a fixed camera inside the shop  
- Represents real customer activity  


### Transaction Data
The transaction data used in this project is stored in a CSV file generated manually using a Python script to simulate real water shop transactions.

üìÑ **Transaction Dataset:**  
üëâ [View sample_transactions.csv](https://github.com/pavs123-gt/Water-Shop-Analytics/blob/main/sample_transactions.csv)

The `sample_transactions.csv` file contains **one row per customer transaction** and includes the following fields:

| Column Name        | Description |
|--------------------|-------------|
| transaction_id     | Unique ID for each transaction |
| timestamp          | Date and time of the transaction |
| customer_id        | Unique ID assigned to the customer |
| payment_mode       | Mode of payment (Cash / UPI / Coin) |
| can_size           | Size of water can (10L / 20L) |
| number_of_cans     | Number of cans purchased |
| amount             | Total transaction amount |
| payment_status     | Paid or Unpaid |

This dataset is used for:
- Payment mode analysis  
- Customer purchase behavior analysis  
- Unpaid and defaulter identification  
- Daily and monthly revenue analytics  


### Transaction Data Generation
The transaction dataset is generated by running the following Python script:

```bash
python general_sample_transaction.py
```

---

### Project Structure

```bash
WaterShopSystem/
‚îú‚îÄ‚îÄ generate_sample_transaction.py       ‚Üí Generates sample transactions
‚îú‚îÄ‚îÄ detection.py                         ‚Üí Handles detection logic
‚îú‚îÄ‚îÄ face_recognition_pipeline.py         ‚Üí Face recognition pipeline
‚îú‚îÄ‚îÄ run_visit_tracking_hog.py            ‚Üí Visit tracking using HOG
‚îú‚îÄ‚îÄ visit_analytics.py                   ‚Üí Analytics on customer visits
‚îú‚îÄ‚îÄ new_vs_returning_customers.py        ‚Üí Compare new vs returning customers
‚îú‚îÄ‚îÄ payment_and_can_analytics.py         ‚Üí Payment and can purchase analytics
‚îú‚îÄ‚îÄ plot_analytics_charts.py             ‚Üí Plot charts for analytics
‚îú‚îÄ‚îÄ test_visit_tracking.py               ‚Üí Tests for visit tracking
‚îú‚îÄ‚îÄ test_transaction.py                  ‚Üí Tests for transactions
‚îú‚îÄ‚îÄ test_can_shop_activity.py            ‚Üí Tests for can/shop activity
‚îú‚îÄ‚îÄ dashboard.py                          ‚Üí Streamlit dashboard
‚îú‚îÄ‚îÄ dashboard_final.py                    ‚Üí Final version of dashboard
‚îî‚îÄ‚îÄ cctv.mp4                              ‚Üí CCTV video input
```
---
##  Setup & Installation

Follow the steps below to set up the **Water Shop Monitoring & Analytics System**.
This section includes only environment setup and required libraries.

---

### 1Ô∏è‚É£ Create and Activate Conda Environment

```bash
conda create -n water_shop python=3.9 -y
conda activate water_shop
```

---

### 2Ô∏è‚É£ Install Core Data & Analytics Libraries

```bash
pip install pandas numpy scikit-learn
```

---

### 3Ô∏è‚É£ Install Visualization Libraries

```bash
pip install matplotlib seaborn streamlit
```

---

### 4Ô∏è‚É£ Install Computer Vision & Face Recognition Libraries

```bash
pip install opencv-python face_recognition insightface onnxruntime
```

Note:
- `face_recognition` depends on **dlib** and may require CMake and a C++ compiler.
- `insightface` uses **ONNX Runtime**. CPU version (`onnxruntime`) is sufficient.
- Use `onnxruntime-gpu` if CUDA is available.

---

### 5Ô∏è‚É£ Install Backend / API Libraries

```bash
pip install fastapi uvicorn
```

---

### 6Ô∏è‚É£ Install Database Libraries

```bash
pip install sqlalchemy
```

 (PostgreSQL):

```bash
pip install psycopg2-binary
```

---

### 7Ô∏è‚É£ Verify Installation

```bash
python -c "import cv2, face_recognition, insightface, pandas, numpy, matplotlib, streamlit; print('Environment setup successful')"
```

---

###  Notes

- Recommended Python version: 3.8 ‚Äì 3.10
- Conda is recommended for easier installation of OpenCV and dlib
- TensorFlow is optional and not required for the current implementation
- Compatible with Linux, macOS, and Windows
---
##  Processing & Pipeline

The Water Shop Monitoring & Analytics System follows a structured pipeline to process CCTV footage and transaction data, generate analytics, and visualize insights through dashboards.


---

### 1. CCTV Video Input

**Input**
- CCTV video footage (`.mp4`)

**Process**
- Video ingestion for downstream processing

**Output**
- Raw video stream

---

### 2. Frame Extraction

**Script**
- `pipeline.py`

**Input**
- CCTV video footage

**Process**
- Extract frames from video at fixed intervals

**Output**
- Extracted image frames (`frames/` directory)

---

### 3. Face Detection

**Script**
- `detect_faces.py`

**Input**
- Extracted frames

**Process**
- Detect faces in each frame
- Draw bounding boxes around detected faces

**Output**
- Frames with face bounding boxes
- Cropped detected face images

---

### 4. Face Recognition

**Scripts**
- `face_recognition_pipeline.py`
- `init_db.py`

**Input**
- Frames containing detected faces

**Process**
- Generate face embeddings
- Compare embeddings with stored database
- Assign unique customer IDs

**Output**
- `customer_embeddings.pkl`
- `recognition_results.csv`
- `unique_customers.csv`

---

### 5. Visit Tracking

**Scripts**
- `visit_tracking.py`
- `run_visit_tracking.py`
- `run_visit_tracking_hog.py`

**Input**
- Face recognition results

**Process**
- Track customer entry and exit events
- Match faces across frames using similarity scores

**Output**
- `visit_log.csv`
- Customer entry time, exit time, and visit duration

---

### 6. Visit Analytics

**Script**
- `visit_analytics.py`

**Input**
- `visit_log.csv`

**Process**
- Aggregate visit data
- Identify visit frequency and patterns

**Output**
- `daily_visits.csv`
- `monthly_visits.csv`
- `quarterly_visits.csv`
- `repeat_visits.csv`

---

### 7. Payment and Can Analytics

**Script**
- `payment_and_can_analytics.py`

**Input**
- `sample_transactions.csv`

**Process**
- Analyze payment modes (cash, UPI, coin)
- Calculate total amount spent per customer
- Track cans sold per day and per customer

**Output**
- `test_payment_summary.csv`
- `test_total_spent.csv`
- `test_unpaid.csv`
- `test_repeat_defaulters.csv`
- `test_cans_per_day.csv`
- `test_cans_per_customer.csv`

---

### 8. Customer Segmentation

**Script**
- `new_vs_returning_customers.py`

**Input**
- `recognition_results.csv`


**Process**
- Classify customers as new or returning

**Output**
- `new_customers.csv`
- `returning_customers.csv`
- `customer_visit_counts.csv`

---

### 9. Traffic and Shop Activity Analysis

**Process**
- Analyze hourly customer traffic
- Identify first and last customer of the day

**Output**
- `test_traffic_per_hours.csv`
- `rest_first_last_customer.csv`

---

### 10. Visualization and Dashboard

**Scripts**
- `plot_analytics_charts.py`
- `dashboard.py`
- `dashboard_final.py`

**Input**
- All generated analytics CSV files

**Process**
- Generate visual analytics and dashboards

**Output**
- Line charts, bar charts, and pie charts
- Interactive analytics dashboard

---

### 11. Testing and Validation
**Process**
- Validate analytics logic
- Verify data consistency and correctness
  
**Scripts**
- `test_visit_tracking.py`

**Output**
- `test_visit_counts.csv`
- `test_repeat_visitors.csv`
  
**Scripts**
- `test_transactions.py`
  
 **Output**
- `test_total_spent.csv`
- `test_payment_summary.csv`
- `test_unpaid.csv`
- `test_repeat_defaulters.csv`
  
**Scripts**
- `test_can_shop_activity.py`
  
**Output**
- `test_can_per_customer.csv`
- `test_cans_per_day.csv`

---

### Pipeline Completion

Successful execution of the pipeline confirms:

##  Analytics & Reports

This section presents the key analytical insights and visual reports generated by the Water Shop Monitoring & Analytics System.  
All visualizations are created from processed CSV outputs produced during the pipeline execution.

---

### üîπ Top Customers by Visit Count

Shows the most frequent customers based on total visit count, helping identify loyal and high-engagement customers.

![Top Customers by Visit Count](https://github.com/pavs123-gt/Water-Shop-Analytics/blob/main/bar_top_customers.png)

---

### üîπ Customer Visits per Hour

Displays hourly footfall distribution to identify peak and low-traffic hours for operational planning.

![Visits per Hour](https://github.com/pavs123-gt/Water-Shop-Analytics/blob/main/bar_visits_per_hour.png)

---

### üîπ Daily Visit Trends

Illustrates daily customer visit trends over time to monitor shop activity patterns.

![Daily Visits](https://github.com/pavs123-gt/Water-Shop-Analytics/blob/main/line_daily_visits.png)

---

### üîπ New vs Returning Customers

Breakdown of new customers versus returning customers, useful for retention and growth analysis.

![New vs Returning Customers](https://github.com/pavs123-gt/Water-Shop-Analytics/blob/main/pie_new_vs_returning.png)

---

### üîπ Total Spend per Customer

Shows total amount spent by each customer, enabling identification of high-value customers.

![Total Spend per Customer](https://github.com/pavs123-gt/Water-Shop-Analytics/blob/main/total_spend_per_customer.png)

---

###  Summary of Insights

- Identifies peak business hours and customer traffic patterns
- Highlights loyal and high-spending customers
- Differentiates between new and returning customers
- Supports data-driven decisions for shop operations and customer engagement

##  Dashboard & Visualization

The dashboard in this project is **generated dynamically** using Python scripts.  
It is **not a static output file**. Instead, the visualizations are rendered **at runtime** when the dashboard scripts are executed.

---

### üìå Dashboard Scripts

The following scripts are responsible for dashboard generation:

- `dashboard.py`
- `dashboard_final.py`

These scripts read the processed analytics CSV files and render interactive and visual dashboards.

---

### ‚ñ∂Ô∏è How the Dashboard Works

- When the script is executed, the dashboard **opens automatically**
- Visualizations are rendered directly on the screen
- No manual image generation or upload is required

---

### ‚ñ∂Ô∏è Run the Dashboard

```bash
streamlit run  dashboard.py
```
```bash
streamlit run dashboard_final.py
```

##  Tools Used

The Water Shop Monitoring & Analytics System is built using the following tools and technologies across different stages of the pipeline.

---

### üîπ Programming Language
- **Python** ‚Äì Core language used for video processing, analytics, and dashboard development.

---

### üîπ Computer Vision & Face Recognition
- **OpenCV** ‚Äì Video processing, frame extraction, and face detection.
- **face_recognition (dlib-based)** ‚Äì Face encoding and customer identification.
- **InsightFace** ‚Äì Deep learning‚Äìbased face recognition using ONNX models.
- **ONNX Runtime** ‚Äì Efficient inference for InsightFace models.

---

### üîπ Data Processing & Analytics
- **pandas** ‚Äì Data cleaning, transformation, aggregation, and CSV processing.
- **NumPy** ‚Äì Numerical computations and array operations.
- **scikit-learn** ‚Äì Similarity matching and basic analytics support.

---

### üîπ Visualization
- **matplotlib** ‚Äì Line charts, bar charts, and pie charts for analytics outputs.
- **seaborn** ‚Äì Enhanced statistical visualizations (optional).
- **Streamlit** ‚Äì Interactive dashboard creation and real-time visualization.

---

### üîπ Backend & APIs 
- **FastAPI** ‚Äì API development for analytics and data access.
- **Uvicorn** ‚Äì ASGI server for running FastAPI services.

These tools collectively enable end-to-end processing‚Äîfrom CCTV video ingestion and face recognition to analytics generation and interactive dashboard visualization.

##  Future Enhancements

The following enhancements can be implemented to extend the functionality, scalability, and intelligence of the Water Shop Monitoring & Analytics System:

- **RFID-Based Can Tracking**  
  Integrate RFID tags with water cans to automatically track can movement, refills, and returns with higher accuracy.

- **Advanced Payment Recognition**  
  Improve automated detection of payment modes (Cash / UPI / Coins) using computer vision and transaction pattern analysis.

- **Predictive Analytics & Forecasting**  
  Apply machine learning models to predict future customer footfall, peak demand periods, and water can requirements.

- **Anomaly & Fraud Detection**  
  Detect unusual customer behavior, unpaid transaction patterns, or abnormal visit frequencies using anomaly detection techniques.

- **Real-Time Dashboard Updates**  
  Enable near real-time analytics and dashboard updates as CCTV and transaction data are processed.

- **Mobile Application Integration**  
  Develop a mobile app for shop owners to monitor live dashboards, alerts, and daily summaries remotely.

- **Cloud Deployment & Scalability**  
  Deploy the system on cloud platforms (AWS / GCP / Azure) to support larger datasets and multiple shop locations.

- **Automated Reporting & Alerts**  
  Schedule automated daily and monthly reports and send alerts for unpaid customers, high traffic periods, or system issues.

- **Multi-Shop Support**  
  Extend the system to support multiple water shop branches with centralized analytics and reporting.

- **Improved Face Recognition Accuracy**  
  Enhance recognition performance using deep learning‚Äìbased face models and larger training datasets.

These enhancements will help transform the system into a **fully automated, scalable, and intelligent water shop management platform**.

##  Author

**Linguberi Pavani**  
B.Tech Student  
linguberipavani3@gmail.com

üîó GitHub: https://github.com/pavs123-gt



























